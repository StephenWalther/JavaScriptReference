if(!Array.prototype.filter)Array.prototype.filter=function(c){"use strict";if(this===void 0||this===null)throw new TypeError;var b=Object(this),g=b.length>>>0;if(typeof c!=="function")throw new TypeError;for(var d=[],f=arguments[1],a=0;a<g;a++)if(a in b){var e=b[a];c.call(f,e,a,b)&&d.push(e)}return d};function Storage(a){a=a||b();this.get=function(b){if(a)return JSON.parse(a.getItem(b))};this.set=function(c,b){a&&a.setItem(c,JSON.stringify(b))};this.clear=function(){a&&a.clear()};function b(){if(window.localStorage)return window.localStorage}}function ServerData(a){this._resourceUrl=a;this.getNewEntries=function(c,a){var b=this._resourceUrl;if(entriesLastUpdated)b+="?$filter=(LastUpdated%20gt%20"+c+"L)";this.queryService(b,function(b){a&&a(b)})};this.queryService=function(b,a){$.ajax({dataType:"json",url:b,success:function(b){a&&a(b.d)}})};this.saveEntry=function(a,b){if(a.Id)this.editEntry(a,b);else this.addEntry(a,b)};this.addEntry=function(b,a){var c=JSON.stringify(b);$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:this._resourceUrl,data:c,dataType:"json",success:function(){a()}})};this.editEntry=function(a,b){var c=this._resourceUrl+"("+a.Id+")",d=JSON.stringify(a);$.ajax({type:"PUT",contentType:"application/json; charset=utf-8",url:c,data:d,dataType:"json",success:function(){b()}})};this.deleteEntry=function(c,a){var b=this._resourceUrl+"("+c+")";$.ajax({type:"DELETE",contentType:"application/json; charset=utf-8",url:b,dataType:"json",success:function(){a&&a()}})}}var EntriesHelper={merge:function(b,c){b=b||[];var a=b.concat(c);this.sortByIdThenLastUpdated(a);a=this.pruneDuplicates(a);a=this.removeIsDeleted(a);this.sortByName(a);return a},sortByIdThenLastUpdated:function(a){a.sort(function(a,b){return a.Id>b.Id?1:a.Id<b.Id?-1:a.LastUpdated>b.LastUpdated?-1:a.LastUpdated<b.LastUpdated?1:0})},pruneDuplicates:function(d){for(var a,c={Id:-1},e=[],b=0;b<d.length;b++){a=d[b];a.Id!==c.Id&&e.push(a);c=a}return e},removeIsDeleted:function(a){return a.filter(function(a){return!a.IsDeleted})},sortByName:function(a){a.sort(function(c,d){var a=c.Name.toLowerCase(),b=d.Name.toLowerCase();return a>b?1:a<b?-1:0})},getLastLastUpdated:function(c){for(var b=0,a=0;a<c.length;a++)if(c[a].LastUpdated>b)b=c[a].LastUpdated;return b},getEntry:function(c){for(var a,b=0;b<entries.length;b++){a=entries[b];if(a.Id==c)return a}}},Authentication={login:function(d,c,b){var a={userName:d,password:c},e=JSON.stringify(a);$.ajax({type:"POST",contentType:"application/json; charset=utf-8",url:"Services/LoginService.svc/authenticate",data:e,dataType:"json",success:function(a){b(a.d)}})}},adminMode=false,filter="",syntax="all",storage=new Storage,serverData=new ServerData("Services/EntryService.svc/Entries"),entries,entriesLastUpdated;$("#ajaxing").ajaxStart(function(){$(this).show()});$("#ajaxing").ajaxStop(function(){$(this).hide()});$(window).bind("offline",function(){$("#offline").show()});$(window).bind("online",function(){$("#offline").hide()});loadData();function resetData(){storage.clear();loadData()}function loadData(a){entries=storage.get("entries")||[];entriesLastUpdated=storage.get("entriesLastUpdated")||0;serverData.getNewEntries(entriesLastUpdated,function(b){if(b.length){entries=EntriesHelper.merge(entries,b);entriesLastUpdated=EntriesHelper.getLastLastUpdated(entries);storage.set("entries",entries);storage.set("entriesLastUpdated",entriesLastUpdated);a&&a()}})}$("#syntaxOptions").buttonset().change(displayResults);$("#loginForm").dialog({autoOpen:false,height:240,width:300,modal:true,buttons:{"Log In":{id:"btnDoLogin",text:"Log In",click:function(){Authentication.login($("#userName").val(),$("#password").val(),function(a){adminMode=a;if(adminMode){$(".admin").show();$("#btnLogin").hide();$("#loginForm").dialog("close")}else $("#badLoginMessage").show()})}}}});$("#btnLogin").button().click(function(){$("#loginForm").dialog("open")});$("#editEntryForm").dialog({autoOpen:false,height:590,width:550,modal:true,buttons:{Save:function(){var b=[];$("input[name=entryBrowser]:checked").each(function(){b.push($(this).val())});var a={Id:$("#entryId").val(),Name:$("#entryName").val(),OwnerId:$("#entryOwnerId").val(),Syntax:$("input[name=entrySyntax]:checked").val(),Browsers:b.join(","),ShortDescription:$("#entryShortDescription").val(),FullDescription:$("#entryFullDescription").val()};if(!a.OwnerId)a.OwnerId=null;serverData.saveEntry(a,function(){loadData(function(){displayResults()})});$(this).dialog("close")}}});$("#btnAddEntry").button().click(function(){var a={Syntax:"function",Browsers:""};updateEditEntryTemplate(a);$("#editEntryForm").dialog("open")});$("#entryDetailsForm").dialog({autoOpen:false,height:590,width:550,modal:true});$(".btnEntryDetails").live("click",function(b){b.preventDefault();var c=$(b.target).attr("data-id"),a=EntriesHelper.getEntry(c);$("#entryDetailsForm").empty();$("#entryDetailsTemplate").tmpl(a).appendTo("#entryDetailsForm");$("#entryDetailsForm").dialog("option","title",a.Name);$("#entryDetailsForm").dialog("open")});$("#filter").keyup(displayResults);$("#deleteEntry").live("click",function(b){if(confirm("Are you sure!?")){var a=$(b.target).attr("data-id");serverData.deleteEntry(a,function(){loadData(function(){displayResults()});$("#entryDetailsForm").dialog("close")})}});$("#editEntry").live("click",function(c){var b=$(c.target).attr("data-id");$("#entryDetailsForm").dialog("close");$("#editEntryForm").dialog("open");var a=EntriesHelper.getEntry(b);updateEditEntryTemplate(a)});function updateEditEntryTemplate(a){$("#editEntryForm").empty();$("#editEntryTemplate").tmpl(a).appendTo("#editEntryForm")}function displayResults(){filter=$("#filter").val().toLowerCase();syntax=$("input[name=syntax]:checked").val();$("#results").empty();if(filter===""&&syntax==="all")return;var a=entries.filter(filterFunction);$("#entryTemplate").tmpl(a).appendTo("#results")}function filterFunction(a){return a.Name.toLowerCase().substr(0,filter.length)===filter&&(syntax==="all"||a.Syntax===syntax)}function split(a){return a.split(",")}function checked(a,b){if(a===b)return' checked="checked" '}function checkedContains(c,d){for(var b=c.split(","),a=0;a<b.length;a++)if(b[a]===d)return' checked="checked" '}function getObjectMethods(a){return entries.filter(function(b){if(b.OwnerId==a&&b.Syntax==="function")return true})}function getObjectProperties(a){return entries.filter(function(b){if(b.OwnerId==a&&b.Syntax==="property")return true})}function getObjectName(b){for(var a=0;a<entries.length;a++)if(b==entries[a].Id)return entries[a].Name}function removeMethodArguments(a){return a.replace(/\(.*\)/,"")}